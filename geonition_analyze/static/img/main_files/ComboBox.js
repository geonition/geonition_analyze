/*
	Copyright (c) 2004-2010, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


window[esri._dojoScopeName||"dojo"]._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dijit.form.ComboBox"],["require","dojo.window"],["require","dojo.regexp"],["require","dojo.data.util.simpleFetch"],["require","dojo.data.util.filter"],["require","dijit._CssStateMixin"],["require","dijit.form._FormWidget"],["require","dijit.form.ValidationTextBox"],["requireLocalization","dijit.form","ComboBox",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw","ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dijit.form.ComboBox"]){_4._hasResource["dijit.form.ComboBox"]=true;_4.provide("dijit.form.ComboBox");_4.require("dojo.window");_4.require("dojo.regexp");_4.require("dojo.data.util.simpleFetch");_4.require("dojo.data.util.filter");_4.require("dijit._CssStateMixin");_4.require("dijit.form._FormWidget");_4.require("dijit.form.ValidationTextBox");_4.declare("dijit.form.ComboBoxMixin",null,{item:null,pageSize:Infinity,store:null,fetchProperties:{},query:{},autoComplete:true,highlightMatch:"first",searchDelay:100,searchAttr:"name",labelAttr:"",labelType:"text",queryExpr:"${0}*",ignoreCase:true,hasDownArrow:true,templateString:_4.cache("dijit.form","templates/ComboBox.html","<div class=\"dijit dijitReset dijitInlineTable dijitLeft\"\r\n\tid=\"widget_${id}\"\r\n\tdojoAttachPoint=\"comboNode\" waiRole=\"combobox\"\r\n\t><div class='dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer'\r\n\t\tdojoAttachPoint=\"downArrowNode\" waiRole=\"presentation\"\r\n\t\tdojoAttachEvent=\"onmousedown:_onArrowMouseDown\"\r\n\t\t><input class=\"dijitReset dijitInputField dijitArrowButtonInner\" value=\"&#9660; \" type=\"text\" tabIndex=\"-1\" readOnly waiRole=\"presentation\"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/></div\r\n\t><div class='dijitReset dijitValidationContainer'\r\n\t\t><input class=\"dijitReset dijitInputField dijitValidationIcon dijitValidationInner\" value=\"&Chi; \" type=\"text\" tabIndex=\"-1\" readOnly waiRole=\"presentation\"\r\n\t/></div\r\n\t><div class=\"dijitReset dijitInputField dijitInputContainer\"\r\n\t\t><input class='dijitReset dijitInputInner' ${!nameAttrSetting} type=\"text\" autocomplete=\"off\"\r\n\t\t\tdojoAttachEvent=\"onkeypress:_onKeyPress,compositionend\"\r\n\t\t\tdojoAttachPoint=\"textbox,focusNode\" waiRole=\"textbox\" waiState=\"haspopup-true,autocomplete-list\"\r\n\t/></div\r\n></div>\r\n"),baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{"downArrowNode":"dijitDownArrowButton"},_getCaretPos:function(_7){var _8=0;if(typeof (_7.selectionStart)=="number"){_8=_7.selectionStart;}else{if(_4.isIE){var tr=_4.doc.selection.createRange().duplicate();var _9=_7.createTextRange();tr.move("character",0);_9.move("character",0);try{_9.setEndPoint("EndToEnd",tr);_8=String(_9.text).replace(/\r/g,"").length;}catch(e){}}}return _8;},_setCaretPos:function(_a,_b){_b=parseInt(_b);_5.selectInputText(_a,_b,_b);},_setDisabledAttr:function(_c){this.inherited(arguments);_5.setWaiState(this.comboNode,"disabled",_c);},_abortQuery:function(){if(this.searchTimer){clearTimeout(this.searchTimer);this.searchTimer=null;}if(this._fetchHandle){if(this._fetchHandle.abort){this._fetchHandle.abort();}this._fetchHandle=null;}},_onInput:function(_d){if(!this.searchTimer&&(_d.type=="paste"||_d.type=="input")&&this._lastInput!=this.textbox.value){this.searchTimer=setTimeout(_4.hitch(this,function(){this._onKeyPress({charOrCode:229});}),100);}this.inherited(arguments);},_onKeyPress:function(_e){var _f=_e.charOrCode;if(_e.altKey||((_e.ctrlKey||_e.metaKey)&&(_f!="x"&&_f!="v"))||_f==_4.keys.SHIFT){return;}var _10=false;var _11="_startSearchFromInput";var pw=this._popupWidget;var dk=_4.keys;var _12=null;this._prev_key_backspace=false;this._abortQuery();if(this._isShowingNow){pw.handleKey(_f);_12=pw.getHighlightedOption();}switch(_f){case dk.PAGE_DOWN:case dk.DOWN_ARROW:case dk.PAGE_UP:case dk.UP_ARROW:if(!this._isShowingNow){_10=true;_11="_startSearchAll";}else{this._announceOption(_12);}_4.stopEvent(_e);break;case dk.ENTER:if(_12){if(_12==pw.nextButton){this._nextSearch(1);_4.stopEvent(_e);break;}else{if(_12==pw.previousButton){this._nextSearch(-1);_4.stopEvent(_e);break;}}}else{this._setBlurValue();this._setCaretPos(this.focusNode,this.focusNode.value.length);}_e.preventDefault();case dk.TAB:var _13=this.get("displayedValue");if(pw&&(_13==pw._messages["previousMessage"]||_13==pw._messages["nextMessage"])){break;}if(_12){this._selectOption();}if(this._isShowingNow){this._lastQuery=null;this._hideResultList();}break;case " ":if(_12){_4.stopEvent(_e);this._selectOption();this._hideResultList();}else{_10=true;}break;case dk.ESCAPE:if(this._isShowingNow){_4.stopEvent(_e);this._hideResultList();}break;case dk.DELETE:case dk.BACKSPACE:this._prev_key_backspace=true;_10=true;break;default:_10=typeof _f=="string"||_f==229;}if(_10){this.item=undefined;this.searchTimer=setTimeout(_4.hitch(this,_11),1);}},_autoCompleteText:function(_14){var fn=this.focusNode;_5.selectInputText(fn,fn.value.length);var _15=this.ignoreCase?"toLowerCase":"substr";if(_14[_15](0).indexOf(this.focusNode.value[_15](0))==0){var _16=this._getCaretPos(fn);if((_16+1)>fn.value.length){fn.value=_14;_5.selectInputText(fn,_16);}}else{fn.value=_14;_5.selectInputText(fn);}},_openResultList:function(_17,_18){this._fetchHandle=null;if(this.disabled||this.readOnly||(_18.query[this.searchAttr]!=this._lastQuery)){return;}this._popupWidget.clearResultList();if(!_17.length&&!this._maxOptions){this._hideResultList();return;}_18._maxOptions=this._maxOptions;var _19=this._popupWidget.createOptions(_17,_18,_4.hitch(this,"_getMenuLabelFromItem"));this._showResultList();if(_18.direction){if(1==_18.direction){this._popupWidget.highlightFirstOption();}else{if(-1==_18.direction){this._popupWidget.highlightLastOption();}}this._announceOption(this._popupWidget.getHighlightedOption());}else{if(this.autoComplete&&!this._prev_key_backspace&&!/^[*]+$/.test(_18.query[this.searchAttr])){this._announceOption(_19[1]);}}},_showResultList:function(){this._hideResultList();this.displayMessage("");_4.style(this._popupWidget.domNode,{width:"",height:""});var _1a=this.open();var _1b=_4.marginBox(this._popupWidget.domNode);this._popupWidget.domNode.style.overflow=((_1a.h==_1b.h)&&(_1a.w==_1b.w))?"hidden":"auto";var _1c=_1a.w;if(_1a.h<this._popupWidget.domNode.scrollHeight){_1c+=16;}_4.marginBox(this._popupWidget.domNode,{h:_1a.h,w:Math.max(_1c,this.domNode.offsetWidth)});if(_1c<this.domNode.offsetWidth){this._popupWidget.domNode.parentNode.style.left=_4.position(this.domNode,true).x+"px";}_5.setWaiState(this.comboNode,"expanded","true");},_hideResultList:function(){this._abortQuery();if(this._isShowingNow){_5.popup.close(this._popupWidget);this._isShowingNow=false;_5.setWaiState(this.comboNode,"expanded","false");_5.removeWaiState(this.focusNode,"activedescendant");}},_setBlurValue:function(){var _1d=this.get("displayedValue");var pw=this._popupWidget;if(pw&&(_1d==pw._messages["previousMessage"]||_1d==pw._messages["nextMessage"])){this._setValueAttr(this._lastValueReported,true);}else{if(typeof this.item=="undefined"){this.item=null;this.set("displayedValue",_1d);}else{if(this.value!=this._lastValueReported){_5.form._FormValueWidget.prototype._setValueAttr.call(this,this.value,true);}this._refreshState();}}},_onBlur:function(){this._hideResultList();this.inherited(arguments);},_setItemAttr:function(_1e,_1f,_20){if(!_20){_20=this.labelFunc(_1e,this.store);}this.value=this._getValueField()!=this.searchAttr?this.store.getIdentity(_1e):_20;this.item=_1e;_5.form.ComboBox.superclass._setValueAttr.call(this,this.value,_1f,_20);},_announceOption:function(_21){if(!_21){return;}var _22;if(_21==this._popupWidget.nextButton||_21==this._popupWidget.previousButton){_22=_21.innerHTML;this.item=undefined;this.value="";}else{_22=this.labelFunc(_21.item,this.store);this.set("item",_21.item,false,_22);}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);_5.setWaiState(this.focusNode,"activedescendant",_4.attr(_21,"id"));this._autoCompleteText(_22);},_selectOption:function(evt){if(evt){this._announceOption(evt.target);}this._hideResultList();this._setCaretPos(this.focusNode,this.focusNode.value.length);_5.form._FormValueWidget.prototype._setValueAttr.call(this,this.value,true);},_onArrowMouseDown:function(evt){if(this.disabled||this.readOnly){return;}_4.stopEvent(evt);this.focus();if(this._isShowingNow){this._hideResultList();}else{this._startSearchAll();}},_startSearchAll:function(){this._startSearch("");},_startSearchFromInput:function(){this._startSearch(this.focusNode.value.replace(/([\\\*\?])/g,"\\$1"));},_getQueryString:function(_23){return _4.string.substitute(this.queryExpr,[_23]);},_startSearch:function(key){if(!this._popupWidget){var _24=this.id+"_popup";this._popupWidget=new _5.form._ComboBoxMenu({onChange:_4.hitch(this,this._selectOption),id:_24,dir:this.dir});_5.removeWaiState(this.focusNode,"activedescendant");_5.setWaiState(this.textbox,"owns",_24);}var _25=_4.clone(this.query);this._lastInput=key;this._lastQuery=_25[this.searchAttr]=this._getQueryString(key);this.searchTimer=setTimeout(_4.hitch(this,function(_26,_27){this.searchTimer=null;var _28={queryOptions:{ignoreCase:this.ignoreCase,deep:true},query:_26,onBegin:_4.hitch(this,"_setMaxOptions"),onComplete:_4.hitch(this,"_openResultList"),onError:function(_29){_27._fetchHandle=null;console.error("dijit.form.ComboBox: "+_29);_4.hitch(_27,"_hideResultList")();},start:0,count:this.pageSize};_4.mixin(_28,_27.fetchProperties);this._fetchHandle=_27.store.fetch(_28);var _2a=function(_2b,_2c){_2b.start+=_2b.count*_2c;_2b.direction=_2c;this._fetchHandle=this.store.fetch(_2b);};this._nextSearch=this._popupWidget.onPage=_4.hitch(this,_2a,this._fetchHandle);},_25,this),this.searchDelay);},_setMaxOptions:function(_2d,_2e){this._maxOptions=_2d;},_getValueField:function(){return this.searchAttr;},compositionend:function(evt){this._onKeyPress({charOrCode:229});},constructor:function(){this.query={};this.fetchProperties={};},postMixInProperties:function(){if(!this.store){var _2f=this.srcNodeRef;this.store=new _5.form._ComboBoxDataStore(_2f);if(!("value" in this.params)){var _30=this.store.fetchSelectedItem();if(_30){var _31=this._getValueField();this.value=_31!=this.searchAttr?this.store.getValue(_30,_31):this.labelFunc(_30,this.store);}}}this.inherited(arguments);},postCreate:function(){if(!this.hasDownArrow){this.downArrowNode.style.display="none";}var _32=_4.query("label[for=\""+this.id+"\"]");if(_32.length){_32[0].id=(this.id+"_label");var cn=this.comboNode;_5.setWaiState(cn,"labelledby",_32[0].id);}this.inherited(arguments);},uninitialize:function(){if(this._popupWidget&&!this._popupWidget._destroyed){this._hideResultList();this._popupWidget.destroy();}this.inherited(arguments);},_getMenuLabelFromItem:function(_33){var _34=this.labelAttr?this.store.getValue(_33,this.labelAttr):this.labelFunc(_33,this.store);var _35=this.labelType;if(this.highlightMatch!="none"&&this.labelType=="text"&&this._lastInput){_34=this.doHighlight(_34,this._escapeHtml(this._lastInput));_35="html";}return {html:_35=="html",label:_34};},doHighlight:function(_36,_37){var _38="i"+(this.highlightMatch=="all"?"g":"");var _39=this._escapeHtml(_36);_37=_4.regexp.escapeString(_37);var ret=_39.replace(new RegExp("(^|\\s)("+_37+")",_38),"$1<span class=\"dijitComboBoxHighlightMatch\">$2</span>");return ret;},_escapeHtml:function(str){str=String(str).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");return str;},open:function(){this._isShowingNow=true;return _5.popup.open({popup:this._popupWidget,around:this.domNode,parent:this});},reset:function(){this.item=null;this.inherited(arguments);},labelFunc:function(_3a,_3b){return _3b.getValue(_3a,this.searchAttr).toString();}});_4.declare("dijit.form._ComboBoxMenu",[_5._Widget,_5._Templated,_5._CssStateMixin],{templateString:"<ul class='dijitReset dijitMenu' dojoAttachEvent='onmousedown:_onMouseDown,onmouseup:_onMouseUp,onmouseover:_onMouseOver,onmouseout:_onMouseOut' tabIndex='-1' style='overflow: \"auto\"; overflow-x: \"hidden\";'>"+"<li class='dijitMenuItem dijitMenuPreviousButton' dojoAttachPoint='previousButton' waiRole='option'></li>"+"<li class='dijitMenuItem dijitMenuNextButton' dojoAttachPoint='nextButton' waiRole='option'></li>"+"</ul>",_messages:null,baseClass:"dijitComboBoxMenu",postMixInProperties:function(){this._messages=_4.i18n.getLocalization("dijit.form","ComboBox",this.lang);this.inherited(arguments);},_setValueAttr:function(_3c){this.value=_3c;this.onChange(_3c);},onChange:function(_3d){},onPage:function(_3e){},postCreate:function(){this.previousButton.innerHTML=this._messages["previousMessage"];this.nextButton.innerHTML=this._messages["nextMessage"];this.inherited(arguments);},onClose:function(){this._blurOptionNode();},_createOption:function(_3f,_40){var _41=_40(_3f);var _42=_4.doc.createElement("li");_5.setWaiRole(_42,"option");if(_41.html){_42.innerHTML=_41.label;}else{_42.appendChild(_4.doc.createTextNode(_41.label));}if(_42.innerHTML==""){_42.innerHTML="&nbsp;";}_42.item=_3f;return _42;},createOptions:function(_43,_44,_45){this.previousButton.style.display=(_44.start==0)?"none":"";_4.attr(this.previousButton,"id",this.id+"_prev");_4.forEach(_43,function(_46,i){var _47=this._createOption(_46,_45);_47.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");_4.attr(_47,"id",this.id+i);this.domNode.insertBefore(_47,this.nextButton);},this);var _48=false;if(_44._maxOptions&&_44._maxOptions!=-1){if((_44.start+_44.count)<_44._maxOptions){_48=true;}else{if((_44.start+_44.count)>_44._maxOptions&&_44.count==_43.length){_48=true;}}}else{if(_44.count==_43.length){_48=true;}}this.nextButton.style.display=_48?"":"none";_4.attr(this.nextButton,"id",this.id+"_next");return this.domNode.childNodes;},clearResultList:function(){while(this.domNode.childNodes.length>2){this.domNode.removeChild(this.domNode.childNodes[this.domNode.childNodes.length-2]);}},_onMouseDown:function(evt){_4.stopEvent(evt);},_onMouseUp:function(evt){if(evt.target===this.domNode||!this._highlighted_option){return;}else{if(evt.target==this.previousButton){this.onPage(-1);}else{if(evt.target==this.nextButton){this.onPage(1);}else{var tgt=evt.target;while(!tgt.item){tgt=tgt.parentNode;}this._setValueAttr({target:tgt},true);}}}},_onMouseOver:function(evt){if(evt.target===this.domNode){return;}var tgt=evt.target;if(!(tgt==this.previousButton||tgt==this.nextButton)){while(!tgt.item){tgt=tgt.parentNode;}}this._focusOptionNode(tgt);},_onMouseOut:function(evt){if(evt.target===this.domNode){return;}this._blurOptionNode();},_focusOptionNode:function(_49){if(this._highlighted_option!=_49){this._blurOptionNode();this._highlighted_option=_49;_4.addClass(this._highlighted_option,"dijitMenuItemSelected");}},_blurOptionNode:function(){if(this._highlighted_option){_4.removeClass(this._highlighted_option,"dijitMenuItemSelected");this._highlighted_option=null;}},_highlightNextOption:function(){if(!this.getHighlightedOption()){var fc=this.domNode.firstChild;this._focusOptionNode(fc.style.display=="none"?fc.nextSibling:fc);}else{var ns=this._highlighted_option.nextSibling;if(ns&&ns.style.display!="none"){this._focusOptionNode(ns);}else{this.highlightFirstOption();}}_4.window.scrollIntoView(this._highlighted_option);},highlightFirstOption:function(){var _4a=this.domNode.firstChild;var _4b=_4a.nextSibling;this._focusOptionNode(_4b.style.display=="none"?_4a:_4b);_4.window.scrollIntoView(this._highlighted_option);},highlightLastOption:function(){this._focusOptionNode(this.domNode.lastChild.previousSibling);_4.window.scrollIntoView(this._highlighted_option);},_highlightPrevOption:function(){if(!this.getHighlightedOption()){var lc=this.domNode.lastChild;this._focusOptionNode(lc.style.display=="none"?lc.previousSibling:lc);}else{var ps=this._highlighted_option.previousSibling;if(ps&&ps.style.display!="none"){this._focusOptionNode(ps);}else{this.highlightLastOption();}}_4.window.scrollIntoView(this._highlighted_option);},_page:function(up){var _4c=0;var _4d=this.domNode.scrollTop;var _4e=_4.style(this.domNode,"height");if(!this.getHighlightedOption()){this._highlightNextOption();}while(_4c<_4e){if(up){if(!this.getHighlightedOption().previousSibling||this._highlighted_option.previousSibling.style.display=="none"){break;}this._highlightPrevOption();}else{if(!this.getHighlightedOption().nextSibling||this._highlighted_option.nextSibling.style.display=="none"){break;}this._highlightNextOption();}var _4f=this.domNode.scrollTop;_4c+=(_4f-_4d)*(up?-1:1);_4d=_4f;}},pageUp:function(){this._page(true);},pageDown:function(){this._page(false);},getHighlightedOption:function(){var ho=this._highlighted_option;return (ho&&ho.parentNode)?ho:null;},handleKey:function(key){switch(key){case _4.keys.DOWN_ARROW:this._highlightNextOption();break;case _4.keys.PAGE_DOWN:this.pageDown();break;case _4.keys.UP_ARROW:this._highlightPrevOption();break;case _4.keys.PAGE_UP:this.pageUp();break;}}});_4.declare("dijit.form.ComboBox",[_5.form.ValidationTextBox,_5.form.ComboBoxMixin],{_setValueAttr:function(_50,_51,_52){this.item=null;if(!_50){_50="";}_5.form.ValidationTextBox.prototype._setValueAttr.call(this,_50,_51,_52);}});_4.declare("dijit.form._ComboBoxDataStore",null,{constructor:function(_53){this.root=_53;if(_53.tagName!="SELECT"&&_53.firstChild){_53=_4.query("select",_53);if(_53.length>0){_53=_53[0];}else{this.root.innerHTML="<SELECT>"+this.root.innerHTML+"</SELECT>";_53=this.root.firstChild;}this.root=_53;}_4.query("> option",_53).forEach(function(_54){_54.innerHTML=_4.trim(_54.innerHTML);});},getValue:function(_55,_56,_57){return (_56=="value")?_55.value:(_55.innerText||_55.textContent||"");},isItemLoaded:function(_58){return true;},getFeatures:function(){return {"dojo.data.api.Read":true,"dojo.data.api.Identity":true};},_fetchItems:function(_59,_5a,_5b){if(!_59.query){_59.query={};}if(!_59.query.name){_59.query.name="";}if(!_59.queryOptions){_59.queryOptions={};}var _5c=_4.data.util.filter.patternToRegExp(_59.query.name,_59.queryOptions.ignoreCase),_5d=_4.query("> option",this.root).filter(function(_5e){return (_5e.innerText||_5e.textContent||"").match(_5c);});if(_59.sort){_5d.sort(_4.data.util.sorter.createSortFunction(_59.sort,this));}_5a(_5d,_59);},close:function(_5f){return;},getLabel:function(_60){return _60.innerHTML;},getIdentity:function(_61){return _4.attr(_61,"value");},fetchItemByIdentity:function(_62){var _63=_4.query("> option[value='"+_62.identity+"']",this.root)[0];_62.onItem(_63);},fetchSelectedItem:function(){var _64=this.root,si=_64.selectedIndex;return typeof si=="number"?_4.query("> option:nth-child("+(si!=-1?si+1:1)+")",_64)[0]:null;}});_4.extend(_5.form._ComboBoxDataStore,_4.data.util.simpleFetch);}}};});